@if (user; as currentUser) {
  <div class="container py-4">
    <div class="row g-4">
      <div class="col-12 col-lg-4">
        <div class="card shadow-sm h-100">
          <div class="card-body text-center">
            <div class="avatar mb-3 mx-auto">
              {{ currentUser.displayName[0] }}
            </div>
            <h4>{{ currentUser.displayName }}</h4>
            <p class="text-muted mb-1">{{ currentUser.email }}</p>
            <span class="badge bg-light text-dark">{{
              currentUser.role | titlecase
            }}</span>
            <a
              class="btn btn-outline-primary d-block w-100 mt-3"
              routerLink="/profile/edit"
            >
              Éditer le profil
            </a>
            <button
              type="button"
              class="btn btn-outline-secondary d-block w-100 mt-2"
              (click)="exportMyData()"
            >
              Exporter mes données
            </button>
            <button
              type="button"
              class="btn btn-outline-danger d-block w-100 mt-2"
              (click)="deleteMyAccount()"
            >
              Supprimer mon compte
            </button>
          </div>
        </div>
      </div>
      @if (currentUser.role === "USER") {
        <div class="col-12 col-lg-8">
          <div class="card shadow-sm mb-4">
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h5 class="card-title">Mes recettes</h5>
                <a routerLink="/recipes/new" class="btn btn-primary btn-sm"
                  >Nouvelle recette</a
                >
              </div>
              @if (loadingRecipes) {
                <app-loading-spinner
                  label="Chargement des recettes..."
                ></app-loading-spinner>
              } @else if (!myRecipes.length) {
                <div class="text-muted">
                  Aucune recette créée pour le moment.
                </div>
              } @else {
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Titre</th>
                        <th>Statut</th>
                        <th>Catégorie</th>
                        <th>Note</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (recipe of myRecipes; track recipe.id) {
                        <tr>
                          <td>{{ recipe.title }}</td>
                          <td>
                            @if (recipe.isPublished) {
                              <span class="badge bg-success">Publique</span>
                            } @else {
                              <span class="badge bg-secondary">Brouillon</span>
                            }
                          </td>
                          <td>{{ recipe.category }}</td>
                          <td>★ {{ recipe.rating | number: "1.1-1" }}</td>
                          <td class="text-end">
                            <a
                              class="btn btn-sm btn-outline-secondary me-2"
                              [routerLink]="['/recipes', recipe.id, 'edit']"
                            >
                              Éditer
                            </a>
                            <a
                              class="btn btn-sm btn-outline-primary me-2"
                              [routerLink]="['/recipe', recipe.id]"
                            >
                              Voir
                            </a>
                            <button
                              type="button"
                              class="btn btn-sm btn-outline-danger"
                              (click)="deleteRecipe(recipe.id)"
                            >
                              Supprimer
                            </button>
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>

    @if (currentUser.role === "USER") {
      <div class="card shadow-sm mt-4">
        <div class="card-body">
          <h5 class="card-title mb-4">Mes favoris</h5>
          @if (!loadingFavorites) {
            <div class="row g-4">
              @for (recipe of favorites; track recipe.id) {
                <div class="col-12 col-md-6 col-lg-4">
                  <div class="card h-100 shadow-sm position-relative">
                    <button
                      type="button"
                      class="btn-close position-absolute top-0 end-0 m-2"
                      aria-label="Retirer des favoris"
                      (click)="removeFavorite(recipe.id)"
                    ></button>
                    <div class="card-body d-flex flex-column pt-4">
                      <h6 class="mb-1">{{ recipe.title }}</h6>
                      <p class="text-muted small mb-3">
                        {{ recipe.category || "Sans catégorie" }} •
                        {{ recipe.durationMinutes }} min
                      </p>
                      <div
                        class="mt-auto d-flex justify-content-between align-items-center"
                      >
                        <span>★ {{ recipe.rating | number: "1.1-1" }}</span>
                        <a
                          class="btn btn-sm btn-outline-primary"
                          [routerLink]="['/recipe', recipe.id]"
                        >
                          Voir
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              }
              @if (!favorites.length) {
                <p class="text-muted">Aucun favori pour le moment.</p>
              }
            </div>
          }
        </div>
      </div>
    }
  </div>
}
